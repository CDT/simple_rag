# 🔑 DeepSeek API 密钥配置指南

现在可以直接在设置页面配置 API 密钥了！

## 🌟 新功能特性

### ✅ 界面配置（推荐）

不再需要手动编辑配置文件，直接在设置页面配置：

1. **密码式输入** - 默认隐藏密钥，保护隐私
2. **显示/隐藏切换** - 一键切换查看完整密钥
3. **保存后自动清空** - 提高安全性
4. **直接链接** - 快速跳转到获取密钥的网站
5. **即时生效** - 无需重启服务器

## 📋 配置步骤

### 第 1 步：获取 API 密钥

1. 访问 [https://platform.deepseek.com](https://platform.deepseek.com)
2. 注册/登录您的账号
3. 进入 **API 密钥管理**
4. 点击 **创建新密钥**
5. 复制生成的密钥（格式：`sk-xxxxxxxxxx...`）

### 第 2 步：在应用中配置

**选项 A：通过设置页面（推荐）✨**

```
1. 启动应用 → 打开 http://localhost:5173
2. 点击侧边栏的 ⚙️ 设置
3. 找到"API 配置"部分
4. 在"DeepSeek API 密钥"输入框中粘贴密钥
5. 点击"保存设置"
6. 看到"设置保存成功！"提示
7. 完成！✅
```

**选项 B：编辑配置文件**

```bash
# 编辑 backend/.env 文件
nano backend/.env

# 添加或修改这一行
DEEPSEEK_API_KEY=sk-your-actual-key-here

# 保存并重启服务器
```

### 第 3 步：验证配置

1. 前往 **知识库** 页面
2. 上传测试文档：`example_documents/company_info.txt`
3. 前往 **对话** 页面
4. 输入问题："这个文档讲了什么？"
5. 如果收到回复 ✅ 配置成功！
6. 如果显示错误 ❌ 检查密钥是否正确

## 🖼️ 界面截图

### 设置页面 - API 配置部分

```
┌─────────────────────────────────────────┐
│ 🔑 API 配置                              │
├─────────────────────────────────────────┤
│                                         │
│ API 提供商                               │
│ ┌─────────────────────────────────────┐ │
│ │ DeepSeek                      (禁用) │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ DeepSeek API 密钥                        │
│ ┌─────────────────────────────────────┐ │
│ │ ••••••••••••••••••••        [显示] │ │
│ └─────────────────────────────────────┘ │
│ 从 platform.deepseek.com 获取您的密钥    │
│                                         │
│ 温度                                     │
│ ┌─────────────────────────────────────┐ │
│ │ 精确 ←────●──────────→ 创造性         │ │
│ │           0.7                        │ │
│ └─────────────────────────────────────┘ │
│                                         │
└─────────────────────────────────────────┘

            [取消]  [保存设置]
```

## 🔒 安全特性

### 1. 密码式显示

```
默认显示：sk-••••••••••••••••••••
点击"显示"：sk-abc123def456ghi789jkl
点击"隐藏"：sk-••••••••••••••••••••
```

### 2. 保存后清空

```javascript
// 保存成功后
if (apiKey.value) {
  apiKey.value = ''        // 清空输入框
  showApiKey.value = false // 恢复隐藏状态
}
```

### 3. 后端处理

```javascript
// 更新环境变量
if (settings.apiKey) {
  process.env.DEEPSEEK_API_KEY = settings.apiKey
  
  // 从响应中删除，不返回给前端
  delete settings.apiKey
}
```

## ⚠️ 重要提示

### 密钥安全

| ✅ 应该做 | ❌ 不应该做 |
|---------|----------|
| 定期轮换密钥 | 提交密钥到 Git |
| 为不同环境使用不同密钥 | 在公开场所分享 |
| 保持密钥机密 | 硬编码到代码中 |
| 设置使用限制 | 使用弱密钥 |

### 环境变量优先级

配置生效顺序（从高到低）：

1. **运行时配置** - 通过设置页面更新
2. **环境变量文件** - `backend/.env`
3. **系统环境变量** - 操作系统级别

### 持久化说明

**当前行为：**
- ✅ 立即生效（更新到 `process.env`）
- ❌ 重启后丢失（未持久化到文件）

**如需持久化，可以：**
1. 写入到 `backend/.env` 文件
2. 保存到数据库
3. 使用密钥管理服务

## 🐛 故障排除

### 问题 1：密钥无效

**症状**：保存成功但对话返回 401 错误

**解决方案：**
1. 检查密钥格式（应以 `sk-` 开头）
2. 确认密钥没有过期
3. 验证密钥在 DeepSeek 平台是否有效
4. 重新复制粘贴（避免多余空格）

### 问题 2：保存后仍不工作

**症状**：提示成功但功能不可用

**解决方案：**
```bash
# 检查后端日志
cd backend
node server.js

# 应该看到：
# DeepSeek API key updated
```

### 问题 3：重启后密钥丢失

**症状**：重启服务器后需要重新配置

**原因**：当前实现未持久化到文件

**解决方案：**
- 方案 A：每次启动后重新配置
- 方案 B：使用 `backend/.env` 文件配置
- 方案 C：扩展代码实现持久化

## 💡 使用技巧

### 技巧 1：快速测试

配置后立即测试：

```
1. 设置页面 → 粘贴密钥 → 保存
2. 知识库 → 上传文档
3. 对话 → 输入"总结这个文档"
4. 看到回复 = 成功！
```

### 技巧 2：多环境管理

开发和生产使用不同密钥：

```bash
# 开发环境
DEEPSEEK_API_KEY=sk-dev-xxxxx

# 生产环境  
DEEPSEEK_API_KEY=sk-prod-xxxxx
```

### 技巧 3：监控使用情况

在 DeepSeek 平台查看：
- API 调用次数
- 已用额度
- 错误率统计

## 📊 对比：之前 vs 现在

| 操作 | 之前 | 现在 |
|------|------|------|
| 配置方式 | 编辑文件 | 网页界面 |
| 技术要求 | 需要命令行 | 无需技术背景 |
| 验证方式 | 手动测试 | 即时反馈 |
| 安全性 | 明文显示 | 密码式隐藏 |
| 便捷性 | ⭐⭐ | ⭐⭐⭐⭐⭐ |

## 🎯 最佳实践

### 1. 开发流程

```
获取密钥 → 设置页面配置 → 保存 → 测试 → ✅
```

### 2. 团队协作

- 每个开发者使用自己的密钥
- 不要共享个人密钥
- 生产环境使用专用密钥

### 3. 监控和维护

- 定期检查 API 使用情况
- 设置使用限制和告警
- 及时轮换过期密钥

## 🚀 未来改进

计划中的功能：

- [ ] 密钥验证（保存前测试）
- [ ] 使用统计显示
- [ ] 密钥有效期提醒
- [ ] 持久化到数据库
- [ ] 密钥加密存储
- [ ] 多密钥管理

---

## 📝 快速参考

### 获取密钥
🔗 https://platform.deepseek.com

### 配置密钥
🔧 设置 → API 配置 → DeepSeek API 密钥

### 验证配置
✅ 知识库 → 上传文档 → 对话 → 测试

### 故障排查
📋 检查格式 → 查看日志 → 重新配置

---

**现在配置 DeepSeek API 密钥只需 30 秒！** ⚡

